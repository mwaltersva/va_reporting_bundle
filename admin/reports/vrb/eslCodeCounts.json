{
	"aaData": [
		~[tlist_sql;
			SELECT
				school_name,
				ReceivingServices,
				RefusedServices,
				FormerlyLEP,
				LEAD (CASE WHEN school_name IS NOT NULL THEN chr(44) ELSE NULL END)
				OVER (ORDER BY school_name ASC) comma
			FROM (
				SELECT
					schl.name school_name,
					ps_customfields.getstudentscf(s.id, 'va_lep_serv_cd') esl_code,
					enr.studentid studentid
				FROM (
					SELECT
						s.id studentid,
						NVL(to_number(ps_customfields.getstudentscf(s.id, 'va_servingschool')),s.schoolid) schoolid
					FROM students s
					WHERE
						~[if.~[gpv:snapshot_date]#]to_date('~[gpv:snapshot_date]', 'MM/DD/YYYY') BETWEEN s.entrydate AND s.exitdate[else]current_date BETWEEN s.entrydate AND s.exitdate[/if]
						~[if.is.a.school]AND s.schoolid = ~(curschoolid)[/if]
					UNION ALL
					SELECT
						re.studentid,
						NVL(to_number(ps_customfields.getcf('reenrollments',re.id,'va_servingschool')),re.schoolid) schoolid
					FROM reenrollments re
					WHERE
						~[if.~[gpv:snapshot_date]#]to_date('~[gpv:snapshot_date]', 'MM/DD/YYYY') BETWEEN re.entrydate AND re.exitdate[else]current_date BETWEEN re.entrydate AND re.exitdate[/if]
						~[if.is.a.school]AND re.schoolid = ~(curschoolid)[/if]
				) enr
				JOIN students s ON s.id = enr.studentid
				JOIN schools schl ON schl.school_number = enr.schoolid
				WHERE
					ps_customfields.getstudentscf(s.id, 'va_lep_serv_cd') IS NOT NULL
			) PIVOT (
				count(studentid)
				FOR esl_code IN(
					1 ReceivingServices,
					2 RefusedServices,
					3 FormerlyLep
				)
			) ORDER BY school_name ASC;
		]{
			"school_name":"~(school_name)",
			"receiving_services":~(receivingservices),
			"refused_services":~(refusedservices),
			"formerly_lep":~(formerlylep)
		}~(comma)[/tlist_sql]
	],
	
	"aoColumns": [
		{"mDataProp":"school_name","sTitle":"School Name"},
		{"mDataProp":"receiving_services","sTitle":"Receiving Services"},
		{"mDataProp":"refused_services","sTitle":"Refused Services"},
		{"mDataProp":"formerly_lep","sTitle":"Formerly LEP"}
	],
    "sDom": "T<\"H\"fr>t<\"F\"ip>",
    "oTableTools": {
        "sSwfPath": "/scripts/vrb/DataTables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf"
    },
    "bJQueryUI": true,
    "bPaginate": false,
	"bFilter": false
}
